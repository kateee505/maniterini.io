<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TÄ“riÅ†u pÄrskats</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- ================= HOME ================= -->
<section class="page active" id="home">
  <div class="card welcome">
    <h1>Sveiki!</h1>
    <p>Ko tu esi iztÄ“rÄ“jis?</p>
    <button class="btn btn-dark" onclick="go('chart')">Uz tÄ“riÅ†u pÄrskatu</button>
  </div>

  <div class="card welcome">
    <h2><span class="icon">âš™ï¸</span> IestatÄ«jumi</h2>
    <button class="btn btn-dark" onclick="go('settings')">AtvÄ“rt</button>
  </div>
</section>

<!-- ================= CHART ================= -->
<section class="page" id="chart">
  <div class="card">
    <h2>TÄ“riÅ†u sadalÄ«jums</h2>
    <div class="chart" id="pie"></div>
    <div class="legend" id="legend"></div>
    <button class="btn btn-yellow" onclick="go('add')">+ Pievienot tÄ“riÅ†us</button>
    <button class="btn btn-light" onclick="go('home')">AtpakaÄ¼</button>
  </div>
</section>

<!-- ================= ADD ================= -->
<section class="page" id="add">
  <div class="card">
    <h2>Pievienot tÄ“riÅ†us</h2>
    <input type="number" id="amount" placeholder="Summa â‚¬">
    <select id="category"></select>
    <button class="btn btn-dark" onclick="addExpense()">SaglabÄt</button>
    <button class="btn btn-light" onclick="go('chart')">AtpakaÄ¼</button>
  </div>
</section>

<!-- ================= SETTINGS ================= -->
<section class="page" id="settings">
  <div class="card welcome">
    <h2>IestatÄ«jumi</h2>
    <button class="btn btn-dark" onclick="go('theme')">TÄ“ma</button>
    <button class="btn btn-dark" onclick="go('list')">Saraksta iestatÄ«jumi</button>
    <button class="btn btn-light" onclick="go('home')">AtpakaÄ¼</button>
  </div>
</section>

<!-- ================= THEME ================= -->
<section class="page" id="theme">
  <div class="card">
    <h2>TÄ“mas izvÄ“le</h2>
    <button class="btn btn-dark" onclick="setTheme('dark')">TumÅ¡Ä</button>
    <button class="btn btn-light" onclick="setTheme('light')">GaiÅ¡Ä</button>
    <button class="btn btn-light" onclick="go('settings')">AtpakaÄ¼</button>
  </div>
</section>

<!-- ================= LIST ================= -->
<section class="page" id="list">
  <div class="card">
    <h2>Saraksta iestatÄ«jumi</h2>
    <label>
      <input type="checkbox" id="toggleAmounts" onchange="toggleAmounts()">
      RÄdÄ«t summas
    </label>
    <button class="btn btn-light" onclick="go('settings')">AtpakaÄ¼</button>
  </div>
</section>

<script>
/* ---------- DATA ---------- */
const categories = {
  Pirkumi:{v:0,c:"#60a5fa",i:"ğŸ›’"},
  Online:{v:0,c:"#38bdf8",i:"ğŸ’»"},
  Ä’diens:{v:0,c:"#4ade80",i:"ğŸ½"},
  Abonementi:{v:0,c:"#f87171",i:"ğŸ“º"},
  KomunÄlie:{v:0,c:"#facc15",i:"ğŸ "},
  PÄrskaitÄ«jumi:{v:0,c:"#c084fc",i:"ğŸ’¸"}
};

let showAmounts = JSON.parse(localStorage.getItem("showAmounts")) ?? true;

/* ---------- NAVIGATION ---------- */
function go(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ---------- THEME ---------- */
function setTheme(t){
  document.body.dataset.theme = t;
  localStorage.setItem("theme", t);
}

/* ---------- EXPENSE ---------- */
function addExpense(){
  const a = +amount.value;
  const c = category.value;
  if(!a) return;
  categories[c].v += a;
  save(); update(); go('chart');
}

/* ---------- CHART ---------- */
function update(){
  const total = Object.values(categories).reduce((s,x)=>s+x.v,0);
  if(!total) return;

  let cur=0,g=[],l="";
  Object.entries(categories).forEach(([n,o])=>{
    if(!o.v) return;
    let p=o.v/total*100;
    g.push(`${o.c} ${cur}% ${cur+p}%`);
    cur+=p;
    l+=`<div class="legend-item">
      <span class="rect" style="background:${o.c}"></span>
      ${o.i} ${n} â€” ${p.toFixed(1)}%
      ${showAmounts?` (${o.v.toFixed(2)} â‚¬)`:``}
    </div>`;
  });
  pie.style.background=`conic-gradient(${g})`;
  legend.innerHTML=l;
}

/* ---------- STORAGE ---------- */
function save(){
  localStorage.setItem("data", JSON.stringify(categories));
  localStorage.setItem("showAmounts", showAmounts);
}

function load(){
  const d = JSON.parse(localStorage.getItem("data"));
  if(d) Object.keys(categories).forEach(k=>categories[k].v=d[k].v);
  setTheme(localStorage.getItem("theme")||"dark");
  toggleAmounts.checked = showAmounts;
  update();
}

/* ---------- LIST ---------- */
function toggleAmounts(){
  showAmounts=!showAmounts;
  save(); update();
}

/* ---------- INIT ---------- */
Object.keys(categories).forEach(k=>{
  category.innerHTML+=`<option value="${k}">${categories[k].i} ${k}</option>`;
});
load();
</script>

</body>
</html>
